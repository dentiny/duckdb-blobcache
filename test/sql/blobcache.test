# name: test/sql/blobcache.test
# description: test blobcache extension
# group: [sql]

require blobcache

require parquet

# connection main
statement ok
install tpch

statement ok
load tpch

statement ok
call dbgen(sf=0.3);

statement ok
copy lineitem to 'lineitem.parquet';

statement ok
call enable_logging(level='error', storage_path = 'mylog.csv');

statement ok
select max(l_comment) from read_parquet('fakes3://lineitem.parquet');

statement ok
call disable_logging();

statement ok
call enable_logging(level='error', storage_path = 'otherlog.csv');

# connection reader
# reader: memory
query I
from read_csv('mylog.csv', delim = '|')
----

statement ok
select cache_type, count(*), sum(usage_count) from blobcache_stats() group by all order by all;
